import{a as f,u as m}from"./Host-COnCiDvR.js";import{l as C}from"./logo-CPbpqbZY.js";import{c as i,o as r,a as l,F as g,r as v,O as u,Z as y,b as p,w as P,e as _,_ as b,t as x,P as F}from"./index-DcDe6x07.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as k}from"./VTextField-BNVneRHE.js";import{h as I}from"./VBtn-DDRTgwIh.js";import"./dimensions-1b8KmgWA.js";const w={getCaptcha:()=>{const t=m.getDomain()+"api/captcha";return f.get(t)},doLogin:t=>{const e=m.getDomain()+"api/login";return f.post(e,t)},forget:t=>{const e=m.getDomain()+"api/login/forget";return f.post(e,t)}},V={data(){return{fields:[{title:"帳號",type:"text",data:"userId",value:null,width:"w-100",placeholder:"帳號",appendIcon:null},{title:"密碼",type:"password",data:"password",value:null,width:"w-100",placeholder:"英數字大小寫8-12碼",appendIcon:"mdi-eye-off"},{title:"驗證碼",type:"number",data:"captcha",value:null,width:"w-50",placeholder:null,appendIcon:null}],forgetFields:[{title:"帳號",type:"text",data:"userId",value:null,width:"w-100",placeholder:"帳號",appendIcon:null},{title:"電子郵件",type:"text",data:"email",value:null,width:"w-100",placeholder:"請輸入您的電子郵件",appendIcon:null}],resetFields:[{title:"舊密碼",type:"password",data:"oldPassword",value:null,width:"w-100",placeholder:"英數字大小寫8-12碼",appendIcon:"mdi-eye-off",rules:[]},{title:"新密碼",type:"password",data:"newPassword",value:null,width:"w-100",placeholder:"英數字大小寫8-12碼",appendIcon:"mdi-eye-off",rules:[t=>!!t||"請輸入密碼",t=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,12}$/.test(t)||"密碼需符合英數字大小寫8-12碼"]},{title:"確認新密碼",type:"password",data:"confirmNewPassword",value:null,width:"w-100",placeholder:"英數字大小寫8-12碼",appendIcon:"mdi-eye-off",rules:[t=>!!t||"請輸入密碼",t=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,12}$/.test(t)||"密碼需符合英數字大小寫8-12碼"]}],captchaImg:null,logo:C,showPwd:!1,showOldPwd:!1,showNewPwd:!1,showConfirmNewPwd:!1,appStore:null,showForget:!1,showReset:!1,forgetMessage:"",forTest:!1}},computed:{pwdIcon(){return this.showPwd?"mdi-eye":"mdi-eye-off"},oldPwdIcon(){return this.showOldPwd?"mdi-eye":"mdi-eye-off"},newPwdIcon(){return this.showNewPwd?"mdi-eye":"mdi-eye-off"},confirmNewPwdIcon(){return this.showConfirmNewPwd?"mdi-eye":"mdi-eye-off"},pwdType(){return this.showPwd?"text":"password"},emailError(){const t=this.forgetFields.find(n=>n.data==="email"),e=(t==null?void 0:t.value)||"",d=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e?d.test(e)?"":"電子郵件格式錯誤":""},newPasswordError(){const t=this.resetFields.find(n=>n.data==="newPassword"),e=(t==null?void 0:t.value)||"",d=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,12}$/;return e?d.test(e)?"":"密碼需包含英數字大小寫，長度 8–12 碼":""},passwordMismatchError(){var d,n;const t=((d=this.resetFields.find(s=>s.data==="newPassword"))==null?void 0:d.value)||"",e=((n=this.resetFields.find(s=>s.data==="confirmNewPassword"))==null?void 0:n.value)||"";return e?t===e?"":"兩次輸入的密碼不一致":""},canSubmitNewPassword(){var s,o,a;const t=((s=this.resetFields.find(c=>c.data==="oldPassword"))==null?void 0:s.value)||"",e=((o=this.resetFields.find(c=>c.data==="newPassword"))==null?void 0:o.value)||"",d=((a=this.resetFields.find(c=>c.data==="confirmNewPassword"))==null?void 0:a.value)||"";return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,12}$/.test(e)&&t&&e===d}},mounted(){this.fields[1].appendIcon=this.pwdIcon,this.appStore=F(),this.getCaptcha()},methods:{getCaptcha(){w.getCaptcha().then(t=>{this.captchaImg=t.data})},viewPwd(){this.showPwd=!this.showPwd,this.fields[1].type=this.pwdType,this.fields[1].appendIcon=this.pwdIcon},handleResetViewPwdClick(t){t.title==="舊密碼"?(this.showOldPwd=!this.showOldPwd,this.resetFields[0].type=this.showOldPwd?"text":"password",this.resetFields[0].appendIcon=this.oldPwdIcon):t.title==="新密碼"?(this.showNewPwd=!this.showNewPwd,this.resetFields[1].type=this.showNewPwd?"text":"password",this.resetFields[1].appendIcon=this.newPwdIcon):t.title==="確認新密碼"&&(this.showConfirmNewPwd=!this.showConfirmNewPwd,this.resetFields[2].type=this.showConfirmNewPwd?"text":"password",this.resetFields[2].appendIcon=this.confirmNewPwdIcon)},doLogin(){if(this.forTest)this.appStore.setToken("rextestonly"),this.appStore.setUserName("Admin"),this.$router.push({path:"/"});else{const t={};for(const e of this.fields){if(!e.value){console.log(e.data,"no data");return}t[e.data]=e.value}w.doLogin(t).then(e=>{console.log("res:"+e.data),this.appStore.setToken(e.data.token),this.appStore.setUserName(e.data.userName),this.$router.push({path:"/"})}).catch(e=>{console.log(e),this.getCaptcha()})}},doForget(){const t=this.forgetFields.find(s=>s.data==="email"),e=this.forgetFields.find(s=>s.data==="userId"),d=[];if((!e||!e.value)&&d.push("[帳號]未輸入"),(!t||!t.value)&&d.push("[電子郵件]未輸入"),d.length>0){alert(d.join(`
`));return}const n={};for(const s of this.forgetFields){if(!s.value){console.log(s.data,"no data");return}n[s.data]=s.value}console.log(n),w.forget(n).then(s=>{console.log("成功:",s.data),this.appStore.setToken(s.data.token),this.appStore.setUserName(s.data.userName),this.$router.push({path:"/"})}).catch(s=>{console.log(s),alert("重設密碼失敗!!!")}),this.forgetMessage=`重設連結已寄送至 ${t.value}`,console.log(this.forgetMessage),alert(this.forgetMessage),this.showForget=!1,this.forgetFields.forEach(s=>s.value="")},doReset(){const t=this.resetFields.find(o=>o.data==="oldPassword"),e=this.resetFields.find(o=>o.data==="newPassword"),d=this.resetFields.find(o=>o.data==="confirmNewPassword"),n=[];if((!t||!t.value)&&n.push("[舊密碼]未輸入"),(!e||!e.value)&&n.push("[新密碼]未輸入"),(!d||!d.value)&&n.push("[確認新密碼]未輸入"),n.length>0){alert(n.join(`
`));return}const s={};for(const o of this.resetFields){if(!o.value){console.log(o.data,"no data");return}s[o.data]=o.value}w.reset(s).then(o=>{console.log(o.data),this.appStore.setToken(o.data.token),this.appStore.setUserName(o.data.userName),this.$router.push({path:"/"})}).catch(o=>{console.log(o),alert("更改密碼失敗!!!")}),this.showReset=!1,this.resetFields.forEach(o=>o.value="")}}},S={class:"d-flex align-center login-background",style:{height:"100%"}},z={class:"d-flex flex-column rounded-lg border-thin pa-4 bg-white",style:{width:"480px","max-width":"100%",height:"100%"}},E={class:"d-flex justify-center w-100 mb-2"},U=["src"],A={key:0},T={class:"flex-grow-1 d-flex flex-column justify-start"},M={class:"d-flex"},Z={key:0,class:"w-50 rounded my-3 d-flex align-center ml-2",style:{"background-color":"#909090"}},D=["src"],L={key:1},R={class:"d-flex"},O={key:0,class:"text-red"},j={key:2},B={class:"d-flex"},H={key:0,class:"text-error text-caption mt-1"},q={key:1,class:"text-error text-caption mt-1"};function G(t,e,d,n,s,o){return r(),i("div",S,[l("div",z,[l("div",E,[l("img",{src:s.logo,style:{width:"100%","max-width":"480px"}},null,8,U)]),e[6]||(e[6]=l("div",{class:"text-center"},[l("h1",null,"八方點管理系統")],-1)),!s.showForget&&!s.showReset?(r(),i("div",A,[l("div",T,[(r(!0),i(g,null,v(s.fields,(a,c)=>(r(),i("div",{key:c,class:"d-flex flex-column"},[l("div",M,[l("div",{class:y(["my-3",a.width])},[p(k,{modelValue:a.value,"onUpdate:modelValue":h=>a.value=h,modelModifiers:{trim:!0},"append-inner-icon":a.appendIcon,density:"compact","hide-details":"","hide-spin-buttons":"",label:a.title,placeholder:a.placeholder,type:a.type,variant:"outlined","onClick:appendInner":o.viewPwd},null,8,["modelValue","onUpdate:modelValue","append-inner-icon","label","placeholder","type","onClick:appendInner"])],2),a.title==="驗證碼"?(r(),i("div",Z,[l("img",{class:"rounded-lg",src:s.captchaImg,style:{height:"40px"}},null,8,D)])):u("",!0)])]))),128)),l("div",null,[p(I,{block:"",color:"primary",size:"large",onClick:o.doLogin},{default:P(()=>e[1]||(e[1]=[_("登入")])),_:1},8,["onClick"]),l("a",{href:"#",onClick:e[0]||(e[0]=b(a=>s.showForget=!0,["prevent"]))},"忘記密碼")])])])):s.showForget?(r(),i("div",L,[e[3]||(e[3]=l("h3",null,"重設密碼",-1)),(r(!0),i(g,null,v(s.forgetFields,(a,c)=>(r(),i("div",{key:c,class:"d-flex flex-column"},[l("div",R,[l("div",{class:y(["my-3",a.width])},[p(k,{modelValue:a.value,"onUpdate:modelValue":h=>a.value=h,"append-inner-icon":a.appendIcon,density:"compact","hide-details":"","hide-spin-buttons":"",label:a.title,placeholder:a.placeholder,type:a.type,variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","append-inner-icon","label","placeholder","type"])],2)]),a.data==="email"&&o.emailError?(r(),i("p",O,x(o.emailError),1)):u("",!0)]))),128)),l("div",null,[l("p",null,[p(I,{block:"",color:"primary",size:"large",onClick:o.doForget},{default:P(()=>e[2]||(e[2]=[_("送出")])),_:1},8,["onClick"])])])])):(r(),i("div",j,[e[5]||(e[5]=l("h3",null,"更改密碼",-1)),(r(!0),i(g,null,v(s.resetFields,(a,c)=>(r(),i("div",{key:c,class:"d-flex flex-column"},[l("div",B,[l("div",{class:y(["my-3",a.width])},[p(k,{modelValue:a.value,"onUpdate:modelValue":h=>a.value=h,"append-inner-icon":a.appendIcon,density:"compact","hide-details":"false","hide-spin-buttons":"",label:a.title,placeholder:a.placeholder,rules:a.rules,type:a.type,variant:"outlined","onClick:appendInner":h=>o.handleResetViewPwdClick(a)},null,8,["modelValue","onUpdate:modelValue","append-inner-icon","label","placeholder","rules","type","onClick:appendInner"])],2)]),a.data==="newPassword"&&o.newPasswordError?(r(),i("div",H,x(o.newPasswordError),1)):u("",!0),a.data==="confirmNewPassword"&&o.passwordMismatchError?(r(),i("div",q,x(o.passwordMismatchError),1)):u("",!0)]))),128)),l("div",null,[l("p",null,[p(I,{block:"",color:"primary",disabled:!o.canSubmitNewPassword,size:"large",onClick:o.doReset},{default:P(()=>e[4]||(e[4]=[_("更改密碼")])),_:1},8,["disabled","onClick"])])])]))])])}const J=N(V,[["render",G],["__scopeId","data-v-aa70d4e2"]]),K={},Q={class:"fill-height"};function W(t,e){const d=J;return r(),i("div",Q,[p(d)])}const ae=N(K,[["render",W]]);export{ae as default};
